<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="/media/icon.png" type="image/x-icon">
	<link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/panier.css">
	<script src="/jquery.js" type="text/javascript"></script>
	<script src="/bootstrap.min.js" type="text/javascript"></script>
	<title>Panier</title>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container-fluid">
		  <a class="navbar-brand" href="http://localhost:8080/"><img id="icon" src="/media/icon.png" alt=""></a>
		  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		  </button>
		  <div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav me-auto mb-2 mb-lg-0">
			  <li class="nav-item">
				<a class="nav-link active" aria-current="page" href="http://localhost:8080/">Accueil</a>
			  </li>
			  <li class="nav-item">
				<a class="nav-link" href="http://localhost:8080/panier">Panier</a>
			  </li>
			</ul>
		  </div>
		</div>
	</nav>
	<div>
		<% if (panier.rows.length == 0) { %>
			<p class="vide">Votre panier est vide</p>
			<button id="retour" class="btn btn-light">Retour Ã  la page d'accueil</button>
		<% } else { %>
		<table class="table">
			<tr>
				<th scope="col">Nom</th>
				<th scope="col">Taille</th>
				<th scope="col">Quantite</th>
				<th scope="col">Prix</th>
				<th scope="col">Accessoire</th>
			</tr>
			<% for (colonne of panier.rows) { %>
				<tr>
					<td><%= colonne.nom %></td>
					<td id="taille<%=colonne.id%>"><%= colonne.taille %></td>
					<td id="quantite<%=colonne.id%>"><%= colonne.quantite %></td>
					<td><%= colonne.prix %></td>
					<% if (colonne.accessoire == 'NULL') { %>
						<td id="accessoire<%=colonne.id%>">Pas d'accessoire</td>
					<% } else { %>
						<td id="accessoire<%=colonne.id%>"><%= colonne.accessoire %></td>
					<% } %>
					<td>
						<button id="<%=colonne.id%>" class="btn btn-light supprimer" value="<%=colonne.pid%>">X</button>
					</td>
				</tr>
			<% } %>
		</table>
		<h4><%= prix_total.rows[0].sum %></h4>
		<button id="finaliser" class="btn btn-light">Finaliser ma commande</button>
		<% } %>
	</div>
</body>
<script>
    let btns = document.querySelectorAll('button');
	let finaliser = $("#finaliser");
	let retour = $('#retour');

	for (i of btns) {
        if(i.hasAttribute('value')) {
			i.addEventListener('click', function() {
				$.post('/panier', 
				{
					produit_id : this.value, 
					taille : $("#taille" + this.id).text(), accessoire : $("#accessoire" + this.id).text(),
					quantite : $("#quantite" + this.id).text()
				}, 
				function() {
					window.location.href = "/panier";
				});
			});
		}
	}
    
    finaliser.click(function() {
			window.location.href = "/formulaire";
    });

	retour.click(function() {
		window.location.href = "/";
	});

</script>
</html>